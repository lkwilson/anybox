# Set usr bin
usr_bin="$HOME/bin"
if [ -d "$usr_bin" ]; then
    PATH="$usr_bin:$PATH"
fi

# bash completion
if ! shopt -oq posix; then
    if [ -f /usr/share/bash-completion/bash_completion ]; then
        . /usr/share/bash-completion/bash_completion
    elif [ -f /etc/bash_completion ]; then
        . /etc/bash_completion
    elif [ -f /usr/local/etc/bash_completion ]; then
        . /usr/local/etc/bash_completion # homebrew
    fi
fi

# git
if which git &>/dev/null; then
    if ! shopt -oq posix; then
        if [ -f /usr/share/bash-completion/completions/git ]; then
            . /usr/share/bash-completion/completions/git
        elif [ -f ~/.bash_completion.d/git ]; then
            # This allows you to copy the git completions file and load it without
            # sudo
            . ~/.bash_completion.d/git
        fi
    fi

    # If git st is a git alias, then gst is an alias to git st, and it supports
    # tab completion
    if __git_aliases &>/dev/null; then
        function_exists() {
            declare -f -F $1 > /dev/null
            return $?
        }

        for al in $(__git_aliases); do
            alias g$al="git $al"

            complete_func=_git_$(__git_aliased_command $al)
            function_exists $complete_func && __git_complete g$al $complete_func
        done
    else
        # fallback without completion
        for al in $(git list-aliases | cut -f1 -d"="); do
            alias g$al="git $al"
        done
    fi

    # Other git related aliases
    alias is_git='git rev-parse &>/dev/null'

    # Set git branch PS1
    git_prefix='$(
        is_git || exit 0
        if [ $COLUMNS -lt 40 ]; then
            exit 0
        fi
        branch=$(git branch-name 2>/dev/null)
        branch="$(shorten "$branch" $(( $COLUMNS / 4 )))"
        echo "($branch) "
    )'
    PS1="$git_prefix$PS1"
    unset git_prefix
fi

# fzf
[ -f ~/.fzf.bash ] && source ~/.fzf.bash

if which code &>/dev/null; then
    alias ch='code .'
fi

# Remap capslock to ctrl
which setxkbmap &>/dev/null && {
    setxkbmap -option ctrl:nocaps &>/dev/null
    setxkbmap -o ctrl:nocaps &>/dev/null
}
